define("wixCodeInit",["lodash","coreUtils","platformInit","host-platform-api"],function(e,t,n,r){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1943)}({0:function(t,n){t.exports=e},1:function(e,n){e.exports=t},1943:function(e,t,n){var r,o;r=[n(1944),n(1947),n(50)],void 0===(o=function(e,t,n){"use strict";return{getAppApi:e.getApi,initMainR:t,appsUtils:n.appsUtils,specMapUtils:n.specMapUtils,registerDeps:n.registerDeps}}.apply(t,r))||(e.exports=o)},1944:function(e,t,n){var r,o;r=[n(0),n(50),n(1),n(1945),n(1946),n(86)],void 0===(o=function(e,t,n,r,o,i){"use strict";function a(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments[2],i=!!t.publicModel,a="undefined"!=typeof window&&!window.clientSideRender,d="undefined"==typeof window||window.isPseudoWindow,c=t.wixBiSession,p=c.visitorId,u={viewerSessionId:c.viewerSessionId,visitorId:p,initialTimestamp:c.initialTimestamp,ownerId:t.rendererModel.userId,deviceType:r.isMobileView?"mobile":"desktop",renderCycle:a&&!d?2:1,renderingEnv:d?"backend":"browser",userWarmup:t.userWarmup,locale:t.rendererModel.languageCode,sdkSource:r.sdkSource,namespacesSdkSource:r.namespacesSdkSource,externalComponentsSource:r.externalComponentsSource,wixCodeNamespacesAndElementorySupportSource:r.wixCodeNamespacesAndElementorySupportSource,openExperiments:(n=t.rendererModel.runningExperiments,e.reduce(n,function(e,t,n){return"new"===t&&e.push(n),e},[])),applications:JSON.stringify(r.applications),metaSiteId:t.rendererModel.metaSiteId};return u=s(t)?e.merge(u,{compId:"wixCode_"+o.appDefinitionId,viewMode:i?"site":"preview"}):e.merge(u,{viewMode:i?"site":t.renderFlags.componentViewMode||"preview"})}function s(t){var n=t.rendererModel.clientSpecMap.toJS?t.rendererModel.clientSpecMap.toJS():t.rendererModel.clientSpecMap;return!!t.rendererModel.wixCodeModel&&e.some(n,{type:"siteextension"})}return{getApi:function(){var e=[],d=[],c=t.messageProxy.get(),p=!1,u=!0,l=null,f=null,m=null,g=void 0,v=void 0;return{init:function(d,u,l){if(p)console.warn("Wix code is already initiated");else{var f=t.appsUtils.getAppsBaseInfo({clientSpecMap:u,serviceTopology:d.serviceTopology,rendererModel:d.rendererModel}).length>0;if(s(d)){var m=t.specMapUtils.getAppSpec(u),w=r.buildUrl(d,m,l);g=o.getIFrameForApp(w,m),v=a(d,l,m)}else{if(!f)return;var M=r.buildStaticUrl(d,l);g=o.getIFrameForApp(M,{}),v=a(d,l)}var S=function(n,r){var a;o.isIFrameEvent(n,r)&&("PLATFORM_IFRAME"!==(a=r.data).intent&&"WIX_CODE"!==a.intent||"wix_code_iframe_initialized"!==a.type||n.contentWindow.postMessage(i.messageBuilder.setBootstrapParametersMessage(v),"*"),function(e){return("PLATFORM_IFRAME"===e.intent||"WIX_CODE"===e.intent)&&"wix_code_iframe_loaded"===e.type}(r.data)&&c.setMessageHandler(function(e){n.contentWindow.postMessage(e,"*")}),t.biUtils.shouldUseFallbackReportBI(r.data,e)&&t.biUtils.reportBiWithWixBiSession(r.data),e.forEach(function(e){e(r.data)}))}.bind(null,g);window.addEventListener("message",S,!1),function(e){function t(){var t=window.document.body;t.insertBefore(e,t.firstChild),n.loggingUtils.performance.mark("platform-iframe-added-to-dom")}"loading"!==window.document.readyState?t():window.document.addEventListener("DOMContentLoaded",function(){t()})}(g),p=!0}},destroyAppsContainer:function(){g&&(g.parentNode.removeChild(g),p=!1,c=t.messageProxy.get(),g=void 0)},sendMessage:function(e){e&&c.sendOrHoldMessage(function(e){return d.reduce(function(e,t){return t(e)},e)}(e))},registerMessageHandler:function(t){e.push(t)},registerMessageModifier:function(e){d.push(e)},unregisterMessageHandler:function(t){var n=e.indexOf(t);-1!==n&&e.splice(n,1)},preLoadWidgets:function(e,n){!l&&s(e)&&t.widgetsPreLoader.asyncGetPreLoadMessage(e,n,function(e){u&&!l&&(l=e,c.sendOrHoldMessage(l))})},preLoadUserCode:function(e,n){(!f&&s(e)||t.appsUtils.getAppsBaseInfo({clientSpecMap:e.rendererModel.clientSpecMap,serviceTopology:e.serviceTopology,rendererModel:e.rendererModel}))&&t.widgetsPreLoader.asyncGetPreLoadUserCodeMessage(e,n,function(e){f||(f=e,c.sendOrHoldMessage(f))})},preInitWidgets:function(e,n){!m&&s(e)&&t.widgetsPreLoader.asyncGetPreInitMessage(e,n,function(e){m||(m=e,c.sendOrHoldMessage(m))})},isAppInitiated:function(){return p},getAppsIframe:function(){return g}}}}}.apply(t,r))||(e.exports=o)},1945:function(e,t,n){var r;void 0===(r=function(){"use strict";function e(e,t,n,r){if(function(){if("function"!=typeof URLSearchParams&&"undefined"!=typeof window)return!1;return(new URLSearchParams(window.parent.location.search).get("debug")||"").includes("localWorker")}())return"//localhost/node_modules/santa-wix-code";var o=r?"pub":"dev",i="//"+t.instanceId+"."+o+".",a=e.serviceTopology.wixCloudBaseDomain,s="node_modules/santa-wix-code/"+(n.useWixCodeFallback?"fallback.html":"index.html");return i+function(){for(var e=arguments[0],t=1;t<arguments.length;++t)e=e.replace(/\/$/,"")+"/"+arguments[t].replace(/^\//,"");return e}(a,"_partials",function(e,t){var n,r=e.serviceTopology,o=(n=e.santaBase,/^https?:\/\/localhost(:[0-9]+)?\/?$/.test(n)||function(e){return/^https?:\/\/s3.amazonaws.com\/integration-tests-statics\/(.+)\/SNAPSHOT\/santa?$/.test(e)}(e.santaBase)?r.scriptsLocationMap.santa:e.santaBase);return o=function(e,t){var n=e.lastIndexOf("/");return/^\d+\.\d+\.\d+$/.test(t)?e.substring(0,n+1)+t:e}(o,t),/(.*\/services\/)?(.*)/.exec(o)[2]}(e,n.runtimeSource),s)}return{buildUrl:function(t,n){return e(t,n,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},!!t.publicModel)},buildStaticUrl:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.santaBase+"/node_modules/santa-wix-code/"+(t.useWixCodeFallback?"fallback.html":"index.html")}}}.apply(t,[]))||(e.exports=r)},1946:function(e,t,n){var r,o;r=[n(0)],void 0===(o=function(e){"use strict";return{getIFrameForApp:function(t,n){var r=window.document.createElement("iframe");return r.style.cssText="position: fixed; left: 0; right: 0; top: 0; bottom: 0; width: 1px; height: 1px; background: transparent; border: 0",r.tabIndex=-1,r.setAttribute("aria-hidden","true"),r.src=t,e.get(n,"applicationId")&&e.get(n,"appDefinitionId")&&(r.setAttribute("data-app-id",n.applicationId),r.setAttribute("data-app-definition-id",n.appDefinitionId)),r},isIFrameEvent:function(e,t){return t.source===e.contentWindow}}}.apply(t,r))||(e.exports=o)},1947:function(e,t,n){var r,o;r=[n(0),n(50)],void 0===(o=function(e,t){"use strict";return function(e){var n=e.appApi,r=e.siteModel,o=e.isMobileView,i=e.queryUtil,a=e.currentUrl,s=e.isBot;a=a||window.document.location.href;var d,c=t.wixCodeUrlUtils.buildScriptsSources(r.serviceTopology,{isDebug:i.getParameterByName("debug")}),p=c.sdkSource,u=c.namespacesSdkSource,l=c.externalComponentsSource,f=c.wixCodeNamespacesAndElementorySupportSource,m=(w=i.getParameterByName("useWixCodeFallback"),"false"!==w&&("true"===w||!window.Worker||s)),g={isMobileView:o,sdkSource:p,namespacesSdkSource:u,externalComponentsSource:l,wixCodeNamespacesAndElementorySupportSource:f,runtimeSource:i.getParameterByName("WixCodeRuntimeSource"),ReactSource:i.getParameterByName("ReactSource"),useWixCodeFallback:m},v=i.getParameterByName("viewerPlatformAppSources");var w;g.applications=t.appsUtils.getAppsBaseInfo({rendererModel:r.rendererModel,clientSpecMap:r.rendererModel.clientSpecMap,serviceTopology:r.serviceTopology,viewerPlatformAppSources:v,currentUrl:a,santaBase:r.santaBase}),d=r.rendererModel.clientSpecMap,n.init(r,d,g),function(e){return t.specMapUtils.getAppSpec(e)||g.applications.length}(d)&&(n.preLoadUserCode(r,a),r.publicModel&&n.preLoadWidgets(r,a))}}.apply(t,r))||(e.exports=o)},50:function(e,t){e.exports=n},86:function(e,t){e.exports=r}})});
//# sourceMappingURL=wixCodeInit.min.js.map