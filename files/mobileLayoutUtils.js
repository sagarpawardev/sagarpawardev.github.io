define(["lodash","coreUtilsLib"],function(n,t){return function(n){var t={};function r(e){if(t[e])return t[e].exports;var o=t[e]={i:e,l:!1,exports:{}};return n[e].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=n,r.c=t,r.d=function(n,t,e){r.o(n,t)||Object.defineProperty(n,t,{enumerable:!0,get:e})},r.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},r.t=function(n,t){if(1&t&&(n=r(n)),8&t)return n;if(4&t&&"object"==typeof n&&n&&n.__esModule)return n;var e=Object.create(null);if(r.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:n}),2&t&&"string"!=typeof n)for(var o in n)r.d(e,o,function(t){return n[t]}.bind(null,o));return e},r.n=function(n){var t=n&&n.__esModule?function(){return n.default}:function(){return n};return r.d(t,"a",t),t},r.o=function(n,t){return Object.prototype.hasOwnProperty.call(n,t)},r.p="",r(r.s=7)}([function(t,r){t.exports=n},function(n,t,r){"use strict";r.r(t),r.d(t,"isMergeVirtualGroup",function(){return u}),r.d(t,"isRescaleVirtualGroup",function(){return c}),r.d(t,"isVirtualGroup",function(){return a}),r.d(t,"isDesktopOnlyComponent",function(){return f}),r.d(t,"isTextComponent",function(){return s}),r.d(t,"isGraphicComponent",function(){return p}),r.d(t,"isGroupComponent",function(){return d}),r.d(t,"isColumnsContainerComponent",function(){return l}),r.d(t,"isImageComponent",function(){return y}),r.d(t,"isMasterPage",function(){return m}),r.d(t,"isDockingAllowed",function(){return v}),r.d(t,"isFixedPositionAllowed",function(){return g}),r.d(t,"shouldStretchToScreenWidth",function(){return h}),r.d(t,"isScreenWidthComponent",function(){return T}),r.d(t,"translateComps",function(){return N}),r.d(t,"reparentComponent",function(){return x}),r.d(t,"addComponentsTo",function(){return b}),r.d(t,"removeChildrenFrom",function(){return R}),r.d(t,"removeGroup",function(){return E}),r.d(t,"containsComponent",function(){return S}),r.d(t,"getHeightAccordingToChildren",function(){return G}),r.d(t,"ensureContainerTightlyWrapsChildren",function(){return I}),r.d(t,"isSiteSegmentOrPage",function(){return V}),r.d(t,"isPageComponent",function(){return z}),r.d(t,"isContainerComponent",function(){return C}),r.d(t,"isSiteSegment",function(){return j}),r.d(t,"extractMobilePage",function(){return D}),r.d(t,"getComponentByIdFromStructure",function(){return O}),r.d(t,"unifyGroups",function(){return A}),r.d(t,"getComponentsByIds",function(){return H}),r.d(t,"getParent",function(){return Y}),r.d(t,"getSnugLayout",function(){return P}),r.d(t,"getTinyMenuDefaultPosition",function(){return M}),r.d(t,"getChildren",function(){return X}),r.d(t,"getRangesOverlap",function(){return k}),r.d(t,"getYOverlap",function(){return L}),r.d(t,"getXOverlap",function(){return Z}),r.d(t,"hasGreaterArea",function(){return J}),r.d(t,"haveSufficientOverlap",function(){return Q}),r.d(t,"isEmptyContainer",function(){return $}),r.d(t,"shouldReparentCompToChildOfContainer",function(){return U}),r.d(t,"getAllCompsInStructure",function(){return w});var e=r(0),o=r(2),i=r(4),u=function(n){return e.get(n,"componentType")===o.a.VIRTUAL_GROUP_TYPES.MERGE},c=function(n){return e.get(n,"componentType")===o.a.VIRTUAL_GROUP_TYPES.RESCALE},a=function(n){return c(n)||u(n)};function f(n){return e.get(n,["conversionData","desktopOnly"],!1)}function s(n){return"text"===e.get(n,["conversionData","category"])}function p(n){return"graphic"===e.get(n,["conversionData","category"])||y(n)}function d(n){return n&&"wysiwyg.viewer.components.Group"===n.componentType}function l(n){return"columns"===e.get(n,["conversionData","category"])}function y(n){return"photo"===e.get(n,["conversionData","category"])}function m(n){return"masterPage"===e.get(n,"id")}function v(n){return"wysiwyg.viewer.components.MenuContainer"===e.get(n,"componentType")}function g(n){return"wysiwyg.viewer.components.MenuContainer"===e.get(n,"componentType")}function h(n){var t=function(n){return e.get(n.conversionData,"isScreenWidth",!1)||e.get(n.conversionData,"stretchHorizontally",!1)||e.some(n.components,t)};return V(n)||t(n)}function T(n){return e.get(n.conversionData,"isScreenWidth",!1)||e.some(n.components,T)}function N(n,t,r){void 0===t&&(t=0),void 0===r&&(r=0),e.forEach(n,function(n){n.layout.x+=t,n.layout.y+=r})}function x(n,t,r){b(n,[t],r),N([t],-n.layout.x,-n.layout.y)}function b(n,t,r){var e=X(n);t.length&&e&&(r=void 0!==r?r:e.length,e.splice.apply(e,[r,0].concat(t)))}function R(n,t){var r=X(n);e.remove(r,function(n){return e.includes(t,n)})}function E(n,t){if(d(n)){var r=e.findIndex(t.components,{id:n.id});e.forEach(n.components.reverse(),function(e){b(t,[e],r),N([e],n.layout.x,n.layout.y)}),e.remove(t.components,n)}}function S(n,t){return e.some(X(n),function(n){return t(n)||n&&S(n,t)})}function G(n,t,r){if(!m(n)&&t&&(r||!e.isEmpty(t))){var i=e(t).reject(["conversionData.isInvisible",!0]).reduce(function(n,t){return e.max([n,t.layout.y+t.layout.height,0])},0);return e.get(n,["conversionData","hasTightYMargin"])||e.get(n,["conversionData","hasTightBottomMargin"])?i:i+(h(n)?o.a.SECTION_MOBILE_MARGIN_Y:o.a.COMPONENT_MOBILE_MARGIN_Y+e.get(n.conversionData,"borderWidth",0))}}function I(n,t,r,o){void 0===o&&(o=0);var i=G(n,t,r);if(e.isNumber(i)){var u=e.get(n,["conversionData","minHeight"],o);n.layout.height=Math.max(u,i)}}function V(n){return z(n)||j(n)}function z(n){return"Page"===n.type}function C(n){return"Container"===n.type}function j(n){return e.has(n.conversionData,"siteSegmentRole")}function D(n){var t=i.objectUtils.cloneDeep(n),r=e.has(t,"components")?"components":"children";return e.set(t,r,n.mobileComponents||[])}function O(n,t){if(t.id===n)return t;var r=null;return e.find(X(t),function(t){return r=O(n,t)}),r}function A(n,t){if(n.length>t)n.length=0;else for(var r=function(t){var r=e.findLastIndex(n,function(r,o){return o<t&&(i=n[t],u=r,e.size(e.intersection(i,u))>0);var i,u});-1!==r&&(n[r]=n[r].concat(e.difference(n[t],n[r])),n.splice(t,1))},o=n.length-1;o>=0;o--)r(o)}function H(n,t){var r=X(n);return e.map(t,function(n){return e.find(r,{id:n})||null})}function Y(n,t){var r=X(t);if(e.find(r,{id:n}))return t;var o=null;return e.find(r,function(t){return o=Y(n,t)}),o}function P(n){if(n&&0!==n.length){var t=e.min(e.map(n,"layout.x")),r=e.min(e.map(n,"layout.y"));return{x:t,y:r,width:e.max(e.map(n,function(n){return n.layout.x+n.layout.width}))-t,height:e.max(e.map(n,function(n){return n.layout.y+n.layout.height}))-r,rotationInDegrees:0}}}function M(){return{x:o.a.MOBILE_WIDTH-(o.a.TINY_MENU_SIZE+o.a.SITE_SEGMENT_PADDING_X),y:o.a.SECTION_MOBILE_MARGIN_Y,rotationInDegrees:0}}function X(n){return n.components||n.children}function k(n,t){void 0===n&&(n=[]),void 0===t&&(t=[]);var r=function(n,t){return Math.min(n[1],t[1])-t[0]};return n[0]<=t[0]?r(n,t):r(t,n)}function L(n,t){var r=function(n){return[n.layout.y,n.layout.height+n.layout.y]};return k(r(n),r(t))}function Z(n,t){if(T(n))return t.layout.width;if(T(t))return n.layout.width;var r=function(n){return[n.layout.x,n.layout.width+n.layout.x]};return k(r(n),r(t))}var q=function(n){return n.layout.width*n.layout.height};function J(n,t){return T(n)?n.layout.height>=t.layout.height||q(n)>q(t):!T(t)&&q(n)>q(t)}function Q(n,t,r){var e=Z(n,t),o=L(n,t);if(e<=0||o<=0)return!1;var i=e*o,u=Math.min(q(n),q(t));return i>0&&i/u>=r}function $(n){return!!C(n)&&("columns"===n.conversionData.category?1===e.size(n.components)&&e.isEmpty(n.components[0].components):e.isEmpty(n.components))}function U(n,t){return l(t)&&e.get(n,["conversionData","isInvisible"],!1)}function w(n,t,r){void 0===t&&(t=!1);for(var o=[[n]],i=0,u=o;i<u.length;i++){var c=u[i];e.forEach(c,function(n){var r=t?e.get(n,"mobileComponents"):X(n);e.isEmpty(r)||o.push(r)})}return e(o).flatten().remove(r).keyBy("id").value()}},function(n,t,r){"use strict";r.d(t,"a",function(){return e});var e={MOBILE_WIDTH:320,MARGIN_BETWEEN_TEXT_AND_NON_TEXT:20,COMPONENT_MOBILE_MARGIN_X:10,COMPONENT_MOBILE_MARGIN_Y:10,SECTION_MOBILE_MARGIN_Y:20,SITE_SEGMENT_PADDING_X:20,TINY_MENU_SIZE:50,TEXT_MAX_LENGTH_FOR_RESCALING:25,MIN_WIDTH_FOR_ENLARGE:140,DEFAULT_TEXT_HEIGHT:10,VIRTUAL_GROUP_TYPES:{RESCALE:"RESCALE_VIRTUAL_GROUP",MERGE:"MERGE_VIRTUAL_GROUP"}}},function(n,t,r){"use strict";r.d(t,"e",function(){return u}),r.d(t,"c",function(){return c}),r.d(t,"b",function(){return a}),r.d(t,"a",function(){return s}),r.d(t,"d",function(){return d}),r.d(t,"g",function(){return l}),r.d(t,"h",function(){return y}),r.d(t,"f",function(){return m});var e=r(0),o=r(1),i=.1,u=function(n){return 0===n?0:n/Math.abs(n)},c=function(n,t){return"x"===t?n.layout.width:n.layout.height},a=function(n,t){return n.layout[t]+c(n,t)};function f(n,t,r,o){void 0===o&&(o=i);var u=e.get(n,r),c=e.get(t,r);return Math.abs(u-c)<=o*e.min([u,c])}function s(n,t,r){return n===t||e.size(n)===e.size(t)&&!p(n,r)&&!p(t,r)&&e.every(n,function(n,o){var u=t[o];return n.componentType===u.componentType&&function(n,t,r,o){void 0===o&&(o=i);var u=e.get(n,["layout",r]),a=e.get(t,["layout",r]);return Math.abs(u-a)<=o*e.min([c(n,r),c(t,r)])}(n,u,r)&&("text"===n.conversionData.category?f(n,u,["conversionData","averageNormalizedFontSize"]):f(n,u,["layout","height"])&&f(n,u,["layout","width"]))})}function p(n,t){var r=e.findIndex(n,function(r,o){if(0===o)return!1;var i=a(n[o-1],t),u=r.layout[t]-i;return u<0||u>e.min([c(n[o-1],t),c(r,t)])});return-1!==r&&r!==n.length-1}function d(n){var t=o.getChildren(n);return e.map(n.conversionData.componentsOrder,function(n){return e.find(t,{id:n})})}var l=function(n){return o.isRescaleVirtualGroup(n)&&"reorder"!==n.conversionData.rescaleMethod||n.conversionData.structuralContainer};function y(n,t){var r=e.map(o.getChildren(n),"id");return e.sortBy(t,function(n){return r.indexOf(n.id)})}function m(n){var t=e.pick(n.conversionData.mobileHints,["recommendedWidth","recommendedHeight","recommendedScale","recommendedOrder"]);return!e.isEmpty(t)}},function(n,r){n.exports=t},function(n,t,r){"use strict";r.d(t,"a",function(){return v}),r.d(t,"b",function(){return g}),r.d(t,"c",function(){return G});var e=r(0),o=r(3),i=r(4),u={START_EVENT:"start",END_EVENT:"end"},c=.9,a={HORIZONTAL:1,VERTICAL:1.25};function f(n,t){return e.transform(n,function(n,r,e){var o=t(e);return n[o]=n[o]||{comps:[],distanceToPreviousFragment:r.distanceToPreviousFragment},n[o].comps=n[o].comps.concat(r.comps),n},[])}var s={singleCompRow:function(n,t,r){if("x"===r)return null;var i=e.findIndex(n,function(n){return 1===e.size(n.comps)});if(-1===i)return null;var u=f(n,function(n){return Object(o.e)(n-i)+Object(o.e)(i)});return{type:"singleCompRow",fragments:u,fragmentsEvents:x(t,u)}},verticalDivider:function(n,t,r){if(e.size(n)<3||e.every(n,function(n){return 1===e.size(n.comps)})||"y"===r)return null;var i=function(n,t){var r=e(t.y).partition({eventType:u.START_EVENT}).map(function(n){return e.map(n,"coordinate")}).value(),i=e.max(r[0]),c=e.min(r[1]);return e.findIndex(n,function(n){var t=n.comps[0];return 1===n.comps.length&&t.conversionData.keepIfVerticalDivider&&t.layout.y<=c&&Object(o.b)(t,"y")>=i})}(n,t);if(-1===i)return null;e.set(n[i].comps[0],["conversionData","isVerticalDivider"],!0);var c=f(n,function(n){return Object(o.e)(n-i)+Object(o.e)(i)});return{type:"verticalDivider",fragments:c,fragmentsEvents:x(t,c)}},mirrorPattern:function(n,t,r){if(e.size(n)<2)return null;var i=x(t,n),u=d(r),c=e.map(i,function(n){return p(n[u])}),a=e.every(c,function(n){return Object(o.a)(n,c[0],u)});return a&&a?y(e.flatten(c),t,{type:"mirrorPattern"}):null},chessPattern:function(n,t,r){if("y"!==r||e.size(n)<2||!e.every(n,function(n){return 2===e.size(n.comps)}))return null;var o=x(t,n),i=e.map(o,function(n){return p(n.x)}),u=e.flatMap(i,function(n,t){return l(t)?n:e.reverse(n)}),c=u[0].conversionData.category,a="text"===c?"photo":"text";return e.every(u,function(n,t){return n.conversionData.category===(l(t)?c:a)})?y(u,t,{type:"chessPattern"}):null}},p=function(n){return e(n).map("compRef").uniq().value()},d=function(n){return"x"===n?"y":"x"},l=function(n){return n%2==0};function y(n,t,r){return e.assign(r,{fragments:[{comps:n,distanceToPreviousFragment:-1}],fragmentsEvents:[t]})}function m(n,t){var r=e.findLastIndex(n,function(n){if(n.coordinate===t.coordinate){if(n.eventType===u.START_EVENT&&t.eventType===u.START_EVENT)return n.size>t.size;if(n.eventType===u.END_EVENT&&t.eventType===u.END_EVENT)return n.size<t.size;if(n.eventType===u.START_EVENT&&t.eventType===u.END_EVENT)return n.compRef===t.compRef;if(n.eventType===u.END_EVENT&&t.eventType===u.START_EVENT)return n.compRef!==t.compRef}return n.coordinate<t.coordinate});return n.splice(r+1,0,t),n}function v(n,t){var r=e.transform(n,function(n,r){var e=r.layout[t]||0,i=Object(o.b)(r,t)||e,c=Object(o.c)(r,t)||0;return m(n,{eventType:u.START_EVENT,compRef:r,coordinate:e,size:c}),m(n,{eventType:u.END_EVENT,compRef:r,coordinate:i,size:c}),n},[]);return e.map(r,function(n){return e.omit(n,"size")})}function g(n){var t=[],r=[];return e.forEach(n,function(n){var o=e.last(r);if(n.eventType===u.START_EVENT){if(e.isEmpty(t)){var i={events:[n],distanceToPreviousFragment:o?n.coordinate-e.last(o.events).coordinate:-1};r.push(i)}else o.events.push(n);t.push(n)}else e.remove(t,{compRef:n.compRef}),o.events.push(n)}),e.map(r,function(n){return{comps:p(n.events),distanceToPreviousFragment:n.distanceToPreviousFragment}})}function h(n,t,r){var o=e.maxBy(n,"distanceToPreviousFragment"),i=e.findIndex(n,o),u=f(n,function(n){return n<i?0:1}),c=[n[i-1],o],a=e.filter(t[d(r)],function(n){return e.some(c,function(t){return e.includes(t.comps,n.compRef)})}),s={fragmentsEvents:x(t,u),fragments:u},p=T(c,a,r);return e.assign(s,{maxCompsDistance:p})}function T(n,t,r){var i=function(n,t){return e(n).map(function(n,r){return r?e.map(n,function(n){return e.defaults({closestPoint:n.compRef.layout[t]},n)}):e.map(n,function(n){return e.defaults({closestPoint:Object(o.b)(n.compRef,t)},n)})}).map(function(n,t){return e.reduce(n,function(n,r){var o=e.last(n);return o&&o.eventType!==u.END_EVENT?o.compRef===r.compRef?n.concat([r]):((t&&r.closestPoint<o.closestPoint||!t&&r.closestPoint>o.closestPoint)&&n.splice(n.length-1,1,r),n):n.concat(r.eventType===u.START_EVENT?[r]:[])},[])}).value()}(e.partition(t,function(t){return e.includes(n[0].comps,t.compRef)}),r),c=[0,0],a=[[],[]];for(var f=-1/0;c[0]<i[0].length||c[1]<i[1].length;){var s=c[0]===i[0].length||c[1]===i[1].length?c[0]===i[0].length?1:0:i[0][c[0]].coordinate<=i[1][c[1]].coordinate?0:1,p=i[s][c[s]++];if(p.eventType!==u.END_EVENT){a[s].push(p);var d=[e.maxBy(a[0],"closestPoint"),e.minBy(a[1],"closestPoint")],l=e.get(d,[1,"closestPoint"])-e.get(d,[0,"closestPoint"]);!e.isNaN(l)&&l>f&&(f=l)}else e.remove(a[s],{compRef:p.compRef})}return f}function N(n,t){return e.transform(n,function(n,r){var o=e.findIndex(t,function(n){return e.includes(n.comps,r.compRef)});return n[o]=(n[o]||[]).concat([r]),n},[])}function x(n,t){var r=N(n.x,t),o=N(n.y,t);return e.map(e.keys(t),function(n){return e.assign({},{x:r[n],y:o[n]})})}function b(n,t,r){return function(n,t,r){var o=null;return e.forEach(s,function(e,i){if(!r[i])return!0;var u=e(t.y,n,"y"),c=e(t.x,n,"x");return null===(o=u&&c?null:u||c)}),o}(n,t,r)||function(n,t){var r=e.size(t.x)>1?h(t.x,n,"x"):null,o=e.size(t.y)>1?h(t.y,n,"y"):null;if(r&&o){var i=a.HORIZONTAL*r.maxCompsDistance>a.VERTICAL*o.maxCompsDistance?r:o;return e.pick(i,["fragments","fragmentsEvents"])}return r||o}(n,t)}function R(n,t,r,i){if(e.size(t)<2)return t||[];var u=e.mapValues(r,g);if(1===e.size(u.x)&&1===e.size(u.y))return i.detectSemanticGroups?i.useOverlapRules?function(n,t){t=Object(o.h)(n,t);var r="overlayGroup_"+(t=e.sortBy(t,"layout.y"))[0].id;return e.forEach(t,function(n){return e.set(n,["conversionData","overlayGroupId"],r)}),t}(n,t):function(n,t,r){var o=function(n){return e.some(n,"conversionData.originalLayout")};if(o(t)||e.some(t,function(n){return o(n)}))return S(t),t;E(t);var i=v(t,"y"),u=v(t,"x"),c=R(n,t,{y:i,x:u},r);return S(c),c}(n,t,i):Object(o.h)(n,t);var c=b(r,u,{mirrorPattern:i.detectSemanticGroups,chessPattern:i.detectSemanticGroups,verticalDivider:!0,singleCompRow:!0});return 1===e.size(c.fragments)?c.fragments[0].comps:e.flatMap(c.fragments,function(t,r){return R(n,t.comps,c.fragmentsEvents[r],i)})}function E(n){e.forEach(n,function(n){var t=n.layout,r=e.assign(i.objectUtils.cloneDeep(t),{height:t.height*c,width:t.width*c});n.layout=r,e.set(n,["conversionData","originalLayout"],t)})}function S(n,t){void 0===t&&(t=!0),e.forEach(n,function(n){var t=e.get(n,["conversionData","originalLayout"]);t&&(n.layout=i.objectUtils.cloneDeep(t),delete n.conversionData.originalLayout)}),t&&e.forEach(n,function(n){return S(n.components,!1)})}function G(n,t,r){var o=R(n,t,{y:v(t,"y"),x:v(t,"x")},r);n.conversionData.componentsOrder=e.map(o,"id")}o.h},,function(n,t,r){"use strict";r.r(t);var e=r(1),o=r(0),i=r(5);function u(n,t){var r=i.a(n,t);return i.b(r)}function c(n){if(o.size(n)<=1)return n;var t=o.map(u(n,"y"),"comps");return o.reduce(t,function(t,r){if(1===o.size(r))return t.concat(r);var e=o.map(u(r,"x"),"comps"),i=o.flatMap(e,function(t){return 1===o.size(t)?t:o.sortBy(t,o.findIndex.bind(null,n))});return t.concat(i)},[])}function a(n){var t=e.getChildren(n);if(!t)return{};var r=c(t),i=o.set({},n.id,o.map(r,"id")),u=o.map(t,a);return o.assign.apply(o,[i].concat(u))}r.d(t,"translateComponents",function(){return e.translateComps}),r.d(t,"getSnugLayout",function(){return e.getSnugLayout}),r.d(t,"splitToFragments",function(){return u}),r.d(t,"sortSiblings",function(){return c}),r.d(t,"getComponentsOrder",function(){return a})}])});
//# sourceMappingURL=mobileLayoutUtils.js.map